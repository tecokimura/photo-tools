# exif-update

ファイル名に含まれる撮影日時から JPG の Exif/ファイル日付を一括で更新するための簡易スクリプトです。撮影日情報が欠落・ずれている写真を名前ベースで補正したいときに使います。

## 必要環境
- bash で実行できる環境
- [`exiftool`](https://exiftool.org/) がインストール済みでパスが通っていること

## 対応するファイル名の形式
拡張子を除いたファイル名が下記の形にマッチする JPG のみを対象にします。

```
YYYY-MM-DD_HH.MM.SS.jpg
YYYY-MM-DD HH.MM.SS.jpg
YYMMDD_HHMMSS*.jpg
```

- `YYYY-...` 形式は従来通り、年4桁・月日2桁・時分秒2桁で、日付と時刻の間は `_` または半角スペース、時刻の区切りはドット。
- `YYMMDD_HHMMSS*` 形式は先頭 12 桁を日時とみなし、後ろに任意の文字列が付いていても無視します。例: `251113_091549_7D2.jpg`, `230101_010203-1.JPG`
- `YY` は `20YY` に展開します（25 → 2025年）。世紀の判定は行いません。

## 使い方
```bash
# 反映結果だけを確認するドライラン
./exifup.sh --dry-run /path/to/photos

# 実際に更新する
./exifup.sh /path/to/photos
```

- `/path/to/photos` 配下の `*.jpg`（大文字拡張子も可）をソートして処理します。
- ドライランでは何も書き換えず、対象ファイルと適用する日時を表示します。

## 実際に行うこと
- ファイル名から組み立てた日時 `YYYY:MM:DD HH:MM:SS` を以下に書き込みます。
  - Exif: `DateTimeOriginal`, `ModifyDate`, `CreateDate`
  - ファイルのタイムスタンプ: `FileModifyDate`, `FileCreateDate`
- `exiftool -overwrite_original` を使うため、Exiftool 標準のバックアップ (`*_original`) は残しません。
- パターンに合わないファイル名の JPG は「Skipping」として処理しません。

## 制約・注意点
- `jpg` 拡張子のみ対応（RAW や動画は対象外）。
- ファイル名がパターンに合わない場合はスキップされます。処理前にリネームしておくか、ドライランで対象を確認してください。
- 実行時刻やタイムゾーンによらず、ファイル名の値をそのままセットします。タイムゾーン補正は行いません。
- 既存の Exif 日付は上書きされます。必要なら事前にバックアップを取ってください。
- スクリプト自身にバックアップ処理はありません。`exiftool -overwrite_original` を使うため `*_original` も生成されません。実行前に手動でコピーするか別フォルダで試してください。
- フォルダ内を再帰的に探索します。対象を絞りたい場合はサブフォルダ単位で実行してください。

## トラブルシュート
- `exiftool: command not found` と出た場合は exiftool をインストールしてパスを通してください。
- 「Invalid filename format」でスキップされる場合は、上記のファイル名形式に合わせてリネームしてください。
